<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="48x48" href="/static/favicons/favicon-48x48.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/favicon-180x180.png">
  <title>Health — Espelho de São Miguel</title>
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/health.css">
</head>
<body>
  <div class="wrap">
    {{if .Banner}}
      <div style="width:100%;height:160px;margin:-28px -28px 18px;border-top-left-radius:12px;border-top-right-radius:12px;overflow:hidden;box-shadow:inset 0 -30px 60px rgba(0,0,0,0.4)">
        <img src="{{.Banner}}" alt="banner" style="width:100%;height:100%;object-fit:cover;display:block"/>
      </div>
    {{end}}
    <a href="/" class="back-link">← Back to Relay Info</a>
    <header>
      <div class="logo">
        {{if .Icon}}
          <img src="{{.Icon}}" alt="icon" style="width:100%;height:100%;object-fit:cover"/>
        {{else}}
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="24" height="24" rx="4" fill="var(--accent)"/>
            <path d="M6 12h12M6 8h12M6 16h8" stroke="#000" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        {{end}}
      </div>
      <div style="flex:1">
        <h1>{{.Name}} — Health Status</h1>
        <p class="lead">{{.Description}}</p>
      </div>
    </header>

    <div id="loading" class="loading">Loading health status...</div>
    
    <div id="error" class="error" style="display: none;">
      <div id="error-message"></div>
    </div>

    <div id="overall-status" class="overall-status" style="display: none;">
      <h2>
        <span class="health-indicator status-healthy">
          HEALTHY
        </span>
      </h2>
      <p>Espelho de São Miguel v1.0.0</p>
    </div>

    <div id="health-content" class="foldables" style="display: none;">
      <div class="card">
        <div class="k">Service Information</div>
        <div class="health-item">
          <span class="health-label">Service Name</span>
          <span class="health-value" id="service-name">-</span>
        </div>
        <div class="health-item">
          <span class="health-label">Version</span>
          <span class="health-value" id="service-version">-</span>
        </div>
        <div class="health-item">
          <span class="health-label">Overall Status</span>
          <span class="health-value">
            <span class="health-indicator" id="service-status">-</span>
          </span>
        </div>
      </div>

      <div class="card">
        <div class="k">Health Indicators</div>
        <div class="health-item">
          <span class="health-label">Main Health State</span>
          <span class="health-value">
            <span class="health-indicator" id="main-health">-</span>
          </span>
        </div>
        <div class="health-item">
          <span class="health-label">Publish Health</span>
          <span class="health-value">
            <span class="health-indicator" id="publish-health">-</span>
          </span>
        </div>
        <div class="health-item">
          <span class="health-label">Query Health</span>
          <span class="health-value">
            <span class="health-indicator" id="query-health">-</span>
          </span>
        </div>
      </div>

      <div class="card">
        <div class="k">Failure Tracking</div>
        <div class="health-item">
          <span class="health-label">Consecutive Publish Failures</span>
          <span class="health-value" id="publish-failures">-</span>
        </div>
        <div class="health-item">
          <span class="health-label">Consecutive Query Failures</span>
          <span class="health-value" id="query-failures">-</span>
        </div>
        <div class="health-item">
          <span class="health-label">Failure Threshold</span>
          <span class="health-value">10 failures</span>
        </div>
      </div>

      <div class="card">
        <div class="k">Health Legend</div>
        <div class="health-item">
          <span class="health-label">
            <span class="health-indicator health-green">GREEN</span>
          </span>
          <span class="health-value">No failures</span>
        </div>
        <div class="health-item">
          <span class="health-label">
            <span class="health-indicator health-yellow">YELLOW</span>
          </span>
          <span class="health-value">1-9 failures</span>
        </div>
        <div class="health-item">
          <span class="health-label">
            <span class="health-indicator health-red">RED</span>
          </span>
          <span class="health-value">10+ failures</span>
        </div>
      </div>
    </div>

    <div class="refresh-info">
      Auto-refreshes every 10 seconds • Last updated: <span id="last-updated">-</span>
    </div>

    <footer>
      <div style="color:var(--muted);font-size:0.85rem">
        Powered by <a href="https://github.com/fiatjaf/khatru" target="_blank" rel="noopener">khatru</a> and <a href="https://github.com/girino/saint-michaels-mirror" target="_blank" rel="noopener">Espelho de São Miguel</a> — © 2003-2025 <a href="https://github.com/girino" target="_blank" rel="noopener">Girino Vey</a> — <span>{{.Version}}</span>
      </div>
    </footer>
  </div>

  <script src="/static/js/health-page.js"></script>
</body>
</html>
