<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="48x48" href="/static/favicons/favicon-48x48.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/favicons/favicon-180x180.png">
  <title>Stats — Espelho de São Miguel</title>
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/stats.css">
</head>
<body>
  <div class="wrap">
    {{if .Banner}}
      <div style="width:100%;height:160px;margin:-28px -28px 18px;border-top-left-radius:12px;border-top-right-radius:12px;overflow:hidden;box-shadow:inset 0 -30px 60px rgba(0,0,0,0.4)">
        <img src="{{.Banner}}" alt="banner" style="width:100%;height:100%;object-fit:cover;display:block"/>
      </div>
    {{end}}
    <a href="/" class="back-link">← Back to Relay Info</a>
    <header>
      <div class="logo">
        {{if .Icon}}
          <img src="{{.Icon}}" alt="icon" style="width:100%;height:100%;object-fit:cover"/>
        {{else}}
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="24" height="24" rx="4" fill="var(--accent)"/>
            <path d="M6 12h12M6 8h12M6 16h8" stroke="#000" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        {{end}}
      </div>
      <div style="flex:1">
        <h1>{{.Name}} — Statistics</h1>
        <p class="lead">{{.Description}}</p>
      </div>
    </header>

    <div id="loading" class="loading">Loading statistics...</div>
    
    <div id="error" class="error" style="display: none;">
      <div id="error-message"></div>
    </div>

    <div id="stats-content" style="display: none;">
      <div class="meta">
        <div class="card">
          <div class="k">Application</div>
          <div class="stat-item">
            <span class="stat-label">Version</span>
            <span class="stat-value" id="app-version">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Uptime</span>
            <span class="stat-value" id="app-uptime">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Goroutines</span>
            <span class="stat-value" id="app-goroutines">-</span>
          </div>
        </div>
        <div class="card">
          <div class="k">Memory & GC</div>
          <div class="stat-item">
            <span class="stat-label">Memory Used</span>
            <span class="stat-value" id="app-memory-used">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Memory Total</span>
            <span class="stat-value" id="app-memory-total">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">GC Cycles</span>
            <span class="stat-value" id="app-gc-cycles">-</span>
          </div>
        </div>
        <div class="card">
          <div class="k">Relay Operations</div>
          <div class="stat-item">
            <span class="stat-label">Publish Attempts</span>
            <span class="stat-value" id="relay-publish-attempts">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Publish Successes</span>
            <span class="stat-value" id="relay-publish-successes">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Publish Failures</span>
            <span class="stat-value" id="relay-publish-failures">-</span>
          </div>
        </div>
        <div class="card">
          <div class="k">Query Operations</div>
          <div class="stat-item">
            <span class="stat-label">Query Requests</span>
            <span class="stat-value" id="relay-query-requests">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Query Events Returned</span>
            <span class="stat-value" id="relay-query-events">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Count Requests</span>
            <span class="stat-value" id="relay-count-requests">-</span>
          </div>
        </div>
      </div>

      <div class="foldables">
        <div class="card">
          <div class="k">Health Status</div>
          <div class="stat-item">
            <span class="stat-label">Overall Health</span>
            <span class="stat-value">
              <span class="health-indicator" id="health-overall">-</span>
            </span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Publish Health</span>
            <span class="stat-value">
              <span class="health-indicator" id="health-publish">-</span>
            </span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Query Health</span>
            <span class="stat-value">
              <span class="health-indicator" id="health-query">-</span>
            </span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Consecutive Publish Failures</span>
            <span class="stat-value" id="health-publish-failures">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Consecutive Query Failures</span>
            <span class="stat-value" id="health-query-failures">-</span>
          </div>
        </div>
        <div class="card">
          <div class="k">Performance</div>
          <div class="stat-item">
            <span class="stat-label">Avg Publish Duration</span>
            <span class="stat-value" id="perf-publish-avg">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Query Duration</span>
            <span class="stat-value" id="perf-query-avg">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Count Duration</span>
            <span class="stat-value" id="perf-count-avg">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Publish Time</span>
            <span class="stat-value" id="perf-publish-total">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Query Time</span>
            <span class="stat-value" id="perf-query-total">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Total Count Time</span>
            <span class="stat-value" id="perf-count-total">-</span>
          </div>
        </div>
      </div>
    </div>

    <div class="refresh-info">
      Auto-refreshes every 10 seconds • Last updated: <span id="last-updated">-</span>
    </div>

    <footer>
      <div style="color:var(--muted);font-size:0.85rem">
        Powered by <a href="https://github.com/fiatjaf/khatru" target="_blank" rel="noopener">khatru</a> and <a href="https://github.com/girino/saint-michaels-mirror" target="_blank" rel="noopener">Espelho de São Miguel</a> — © 2003-2025 <a href="https://github.com/girino" target="_blank" rel="noopener">Girino Vey</a> — <span>{{.Version}}</span>
      </div>
    </footer>
  </div>

  <script src="/static/js/stats-page.js"></script>
</body>
</html>
