<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{.Name}} — NIP-11 Relay Info</title>
  <style>
    /* Nostr-inspired palette */
    :root{
      --bg:#0b0b0b; /* deep near-black */
      --card:#0f1113;
      --muted:#9aa4af;
      --accent:#ffcc00; /* nostr/yellow accent */
      --accent-2:#ffd966;
      --white:#ffffff;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#060606);color:var(--white);font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:980px;margin:48px auto;padding:28px;background:var(--card);border-radius:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6);}
    header{display:flex;gap:16px;align-items:center}
    .logo{width:80px;height:80px;border-radius:10px;overflow:hidden;background:var(--glass);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--bg)}
    h1{margin:0;font-size:1.6rem}
    p.lead{margin:6px 0 14px;color:var(--muted)}
  .meta{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
    .k{color:var(--muted);font-size:0.85rem}
    .v{color:var(--white);word-break:break-all}
    footer{margin-top:18px;color:var(--muted);font-size:0.85rem}
  .nips{display:flex;gap:8px;flex-wrap:wrap}
  .card .nips{margin-top:8px}
  .nip{background:var(--accent);padding:4px 8px;border-radius:6px;color:#000;font-weight:600;text-decoration:none;display:inline-block;font-size:0.95rem;line-height:1.1;vertical-align:middle}
  .nip:hover{background:var(--accent-2)}
  /* tooltip */
  .nip[data-desc]{position:relative}
  .nip[data-desc]:hover::after{content:attr(data-desc);position:absolute;left:0;bottom:calc(100% + 8px);white-space:normal;max-width:320px;background:rgba(0,0,0,0.85);color:#fff;padding:8px;border-radius:6px;font-size:0.85rem;z-index:40}
    a.pill{display:inline-block;padding:6px 10px;border-radius:8px;background:var(--accent);color:#000;text-decoration:none;font-weight:700}
    /* foldable sections layout */
    .foldables{display:grid;grid-template-columns:1fr;gap:12px;margin-top:18px}
    @media(min-width:900px){
      .foldables{grid-template-columns:1fr 1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    {{if .Banner}}
      <div style="width:100%;height:160px;margin:-28px -28px 18px;border-top-left-radius:12px;border-top-right-radius:12px;overflow:hidden;box-shadow:inset 0 -30px 60px rgba(0,0,0,0.4)">
        <img src="{{.Banner}}" alt="banner" style="width:100%;height:100%;object-fit:cover;display:block"/>
      </div>
    {{end}}
    <header>
      <div class="logo">
        {{if .Icon}}
          <img src="{{.Icon}}" alt="icon" style="width:100%;height:100%;object-fit:cover"/>
        {{else}}
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="4" fill="var(--accent)"/><path d="M6 12h12M6 8h12M6 16h8" stroke="#000" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        {{end}}
      </div>
      <div style="flex:1">
        <h1>{{.Name}}</h1>
        <p class="lead">{{.Description}}</p>
        <div style="display:flex;gap:10px;align-items:center">
          {{if .ServiceURL}}<a class="pill" href="{{.ServiceURL}}" target="_blank" rel="noopener">Website</a>{{end}}
          {{if .Contact}}
            <span class="k">Contact:</span>&nbsp;
            {{if .ContactIsLink}}
              <a class="v" href="{{.ContactHref}}" target="_blank" rel="noopener">{{.Contact}}</a>
            {{else}}
              <span class="v">{{.Contact}}</span>
            {{end}}
          {{end}}
        </div>
      </div>
    </header>

    <div class="meta">
      <div class="card">
        <div class="k">Public key</div>
  <div class="v">{{if .PubKeyNPub}}<a class="v" href="https://njump.me/{{.PubKeyNPub}}" target="_blank" rel="noopener">{{.PubKeyNPub}}</a>{{else}}{{.PubKey}}{{end}}</div>
      </div>
      <div class="card">
        <div class="k">Software / Version</div>
        <div class="v">{{if .SoftwareIsLink}}<a class="v" href="{{.SoftwareHref}}" target="_blank" rel="noopener">{{.Software}}</a>{{else}}{{.Software}}{{end}} — {{.Version}}</div>
      </div>
      <div class="card">
        <div class="k">Supported NIPs</div>
        <div class="nips">
          {{range .SupportedNIPs}}
            {{ $k := printf "%02d" . }}
            <a class="nip" href="https://github.com/nostr-protocol/nips/blob/master/{{$k}}.md" target="_blank" rel="noopener" data-desc="{{index $.NipDescs $k}}">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="vertical-align:middle;margin-right:6px"><path d="M12 .5C5.648.5.5 5.648.5 12c0 5.086 3.292 9.395 7.862 10.917.575.106.78-.25.78-.556 0-.274-.01-1-.015-1.96-3.197.695-3.873-1.54-3.873-1.54-.523-1.33-1.276-1.684-1.276-1.684-1.043-.713.08-.699.08-.699 1.153.081 1.76 1.184 1.76 1.184 1.025 1.755 2.69 1.25 3.344.956.104-.744.402-1.25.731-1.538-2.553-.29-5.238-1.276-5.238-5.678 0-1.254.448-2.28 1.183-3.086-.119-.289-.512-1.454.113-3.03 0 0 .966-.31 3.166 1.18a11.03 11.03 0 0 1 2.882-.388c.978.004 1.964.132 2.882.388 2.2-1.49 3.164-1.18 3.164-1.18.627 1.576.234 2.741.115 3.03.737.806 1.182 1.832 1.182 3.086 0 4.413-2.688 5.385-5.25 5.67.413.356.78 1.058.78 2.134 0 1.54-.014 2.78-.014 3.158 0 .31.203.668.787.555C20.712 21.394 24 17.087 24 12 24 5.648 18.352.5 12 .5z"/></svg>
              NIP-{{$k}}
            </a>
          {{end}}
        </div>
      </div>
      <div class="card">
        <div class="k">Icon / Banner</div>
        <div class="v">{{if .Icon}}Icon set{{else}}—{{end}} / {{if .Banner}}Banner set{{else}}—{{end}}</div>
      </div>
    </div>

  <div class="foldables">
  <section style="margin-top:18px" class="card">
      <div class="k">Full NIP-11 JSON</div>
      <details id="nip11-details">
        <summary style="cursor:pointer">Show NIP-11 JSON</summary>
        <pre id="nip11" style="white-space:pre-wrap;margin:8px 0 0;color:var(--muted);font-size:0.9rem;background:transparent;border:none;padding:0">(click to load)</pre>
      </details>
      <script>
        document.getElementById('nip11-details').addEventListener('toggle', async function(e){
          if(!this.open) return;
          const pre = document.getElementById('nip11');
          pre.textContent = 'loading...';
          try{
            const resp = await fetch('/', { headers: { 'Accept': 'application/nostr+json' } });
            if(!resp.ok) throw new Error('failed to fetch');
            const data = await resp.json();
            pre.textContent = JSON.stringify(data, null, 2);
          }catch(err){
            pre.textContent = 'failed to load NIP-11: '+err;
          }
        });
      </script>
  </section>

  <section style="margin-top:12px" class="card">
      <div class="k">Relay Stats</div>
      <details id="stats-details">
        <summary style="cursor:pointer">Show stats</summary>
        <pre id="stats" style="white-space:pre-wrap;margin:8px 0 0;color:var(--muted);font-size:0.9rem;background:transparent;border:none;padding:0">(click to load)</pre>
      </details>
      <script>
        document.getElementById('stats-details').addEventListener('toggle', async function(e){
          if(!this.open) return;
          const pre = document.getElementById('stats');
          pre.textContent = 'loading...';
          try{
            const resp = await fetch('/stats');
            if(!resp.ok) throw new Error('failed to fetch');
            const data = await resp.json();
            pre.textContent = JSON.stringify(data, null, 2);
          }catch(err){
            pre.textContent = 'failed to load stats: '+err;
          }
        });
      </script>
  </section>
  </div>

    <footer>
      <div>Powered by khatru — NIP-11 relay info shown above.</div>
    </footer>
  </div>
</body>
</html>
