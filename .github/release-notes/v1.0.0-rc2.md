# v1.0.0-rc2 (draft)

This release candidate accumulates all changes since the project's inception and prepares for the stable 1.0.0 release.

Summary highlights

- Version bump: embedded version updated to `v1.0.0-rc2`.
- Release process: the workflow now replaces an existing release with the same tag and uploads platform-specific binaries individually.
- Relay features: khatru-based relay command, publish forwarding to remotes, query remotes and pooling, CountMany support gated to NIP‑45-capable remotes, NIP‑11 probing using the Accept header.
- Observability: `/stats` endpoint with separate counters for publishes, queries and counts (internal vs external tracked).
- Security/behavior: do not forward khatru internal QueryEvents (except the exact internal adding.kind=5/#e case) and short-circuit internal queries.
- UI & assets: server-rendered homepage, NIP‑11 and stats UI, multiple favicon variants with rounded masks, icon/svg assets.
- CI/Release: GitHub Actions workflows for build/test and release; release automation iterated to be idempotent and robust on restricted runners.

Change categories (grouped)

Features

- Add `cmd/khatru-relay` command and `relaystore` forwarding backend to mirror published events to configured remotes.
- Add query remotes (wss defaults) and QueryEvents via a SimplePool; expose CLI flag `--query-remotes`.
- Forward CountEvents to remotes and use pool.CountMany (NIP‑45 semantics) when remotes advertise NIP‑45.
- Add server-side homepage rendering with NIP‑11 information and a foldable `/stats` UI.

Fixes

- Short-circuit internal khatru QueryEvents to avoid forwarding internal control events; specially handle exact adding.kind=5/#e filter.
- Fix and separate counters for queries vs counts; add metrics for query/count failures and returned events.

Assets & UI

- Add SVG icon variants and generate PNG favicons with rounded masks (40% radius) for modern UIs.
- Improve homepage UI: render contact as mailto/nostr links, show relay npub link, NIP badges linking to nostr-nips.com, responsive layout and stats folding.

Chore / Infrastructure

- Add GAL license and project README with mythic identity text.
- Move Version constant into `cmd/khatru-relay` and embed the tag into builds via ldflags in the release workflow.
- Add `run.sh` helper, example `.env`, and tooling to generate favicons.

CI & Release

- Add GitHub Actions CI workflow (build/test) and a Release workflow that produces platform binaries.
- Iterated workflows to avoid caching/tar extraction conflicts on runners, pinned Go to 1.24.1, and added job-level permissions for release creation.
- Make release creation idempotent: workflow deletes an existing release and recreates it, then uploads artifacts.
- Fallback to curl-based uploads for environments where marketplace action versions are unavailable.

Full chronological commit summary

Below is the full chronological list of commits (oldest → newest) so you have a complete history to include in the RC notes. The lines show short SHA, date, commit message and author.

9db90a3 2025-10-18 Initial commit
38c7ef4 2025-10-18 feat: add khatru relay cmd and relaystore forwarding backend; add verbose/default remotes
3bade8b 2025-10-18 feat: add query remotes (wss defaults) and QueryEvents via SimplePool; expose --query-remotes flag
c45a3e2 2025-10-18 chore: add run.sh to build and run relay with sensible defaults (publish/query remotes)
d8934e6 2025-10-18 feat: expose /stats endpoint; collect publish/query stats in relaystore
7331c8e 2025-10-18 fix: don't count internal QueryEvents (use khatru.IsInternalCall)
cf3864c 2025-10-18 feat: track query failures for query remotes and expose in /stats
ce4f60d 2025-10-18 fix(stats): always count QueryEvents (internal/external) and add debug logs when pool missing
2bbb52c 2025-10-18 chore: add .assistant-ignore marker for secrets (.env)
2814787 2025-10-18 restore removed untracked files: config.go, template, example.env; add template and example env
268f899 2025-10-18 restore main: wire LoadConfig, NIP-11 handlers, RELAY_SECKEY decoding and secret/pubkey handling
bcd09b9 2025-10-18 relaystore: short-circuit internal queries (kind 5 / internal ctx) and return closed channel; adjust counters
d8280d0 2025-10-18 relaystore: only short-circuit exact adding.go kind=5/#e when ctx[1] is nil; keep khatru.IsInternalCall handling
32d51df 2025-10-18 cmd/khatru-relay: restore NIP-11 defaults and let khatru serve nip11; remove homepage/.well-known handlers
000426f 2025-10-18 cmd/khatru-relay: populate more NIP-11 fields from config and ensure supported nips include 11 and 45
21b3f03 2025-10-18 run.sh: read config from .env/.env.local and run binary without CLI flags
a08d5c3 2025-10-18 cmd/khatru-relay: render homepage template server-side with relay NIP-11 info
163593d 2025-10-18 templates: fetch NIP-11 JSON from '/' with Accept: application/nostr+json
cdddccf 2025-10-18 templates: send Accept: application/nostr+json when fetching NIP-11
c04477e 2025-10-18 templates: make NIP-11 JSON foldable and load on open
9378ae2 2025-10-18 templates: add foldable stats section that fetches /stats on open
72859b8 2025-10-18 templates: side-by-side foldable NIP-11 and stats with responsive grid and fresh fetch on open
bbe110b 2025-10-18 cmd/khatru-relay: render contact as mailto or nostr: link when appropriate
9ef132d 2025-10-18 templates: render contact as mailto/nostr link when available
5a7d740 2025-10-18 cmd/khatru-relay: default contact to relay npub when no contact provided
92fd36d 2025-10-18 ui: show relay pubkey in npub form and link it; default contact to npub when empty
bcac465 2025-10-18 ui: show only npub public key when available (fallback to hex)
7b7cadc 2025-10-18 ui: use njump.me links for npub/nprofile instead of nostr: scheme
377c68a 2025-10-18 ui: open external links (website, contact, npub) in new window with rel=noopener
f4a58d0 2025-10-18 ui: make Software field a clickable link when it's an http(s) URL
f3e78a1 2025-10-18 ui: make Supported NIPs clickable links to nostr-nips.com
fa74518 2025-10-18 ui: render NIP badges as buttons and zero-pad numbers for nostr-nips.com links
4a7d45a 2025-10-18 ui: style NIP badges as yellow pills with black text like Website
0d0b125 2025-10-18 ui: reduce NIP pill size to smaller compact style
ae4f5e7 2025-10-18 ui: increase header->meta spacing and slightly enlarge NIP pill font for readability
0116511 2025-10-18 ui: restore header spacing and add margin above NIP badges
025b144 2025-10-18 relaystore: forward CountEvents to query remotes (mirror QueryEvents behavior)
a87bb2d 2025-10-18 relaystore: use pool.CountMany for CountEvents (NIP-45 HyperLogLog aggregation)
98c4152 2025-10-18 relaystore: add CountEvents-specific counters and expose them in Stats
fbc264a 2025-10-18 relaystore: separate count counters only (don't increment query stats in CountEvents)
f0adad0 2025-10-18 relaystore: probe NIP-11 via Accept header and gate CountMany to NIP-45-capable remotes; add countableQueryUrls and fix counters
a774728 2025-10-18 ui: add github icons and nip hover previews; fetch short descriptions from nostr-protocol/nips (cached)
3474ae2 2025-10-19 ui: revert github icon and nip-hover preview; remove nip description fetching
317c853 2025-10-19 assets: add 4 SVG icon variants (monoline, flat, inverted, minimal)
6d895db 2025-10-19 assets: generate favicon PNG sizes from icon.png
22aee1b 2025-10-19 assets: add original icon and banner, add tools used for favicon generation
e1e5067 2025-10-19 chore: serve static assets; add golang.org/x/image dependency
2081280 2025-10-19 ui: add favicon links to template head
e3ecc1a 2025-10-19 assets: regenerate favicons with rounded corners; add rounded-mask to icon-resize tool
76197e0 2025-10-19 assets: apply rounded mask during favicon generation and regenerate PNG favicons
8f1ca42 2025-10-19 assets: increase favicon corner radius to 40% and regenerate PNG favicons
11d8227 2025-10-19 README: myth mapping edits; example.env updates
d1299bd 2025-10-19 chore: add version package, update homepage footer; add GAL LICENSE and README note
8965476 2025-10-19 chore: format LICENSE (GAL)
3ced837 2025-10-19 chore: move version into cmd/khatru-relay package
90c743e 2025-10-19 chore: remove stale version package; use cmd/khatru-relay/version.go
9c8b48e 2025-10-19 chore(release): bump version to 1.0.0-rc1; add GitHub Actions workflows
4c6e5b7 2025-10-19 chore: use Version constant for NIP-11 version field
24916b9 2025-10-19 ci: use setup-go cache; release: embed tag via ldflags and add more platforms
680be7e 2025-10-19 ci: remove cache inputs from workflows to satisfy YAML spec and avoid tar extraction conflicts
c6368d9 2025-10-19 ci: add safe module/build cache (GOMODCACHE/GOCACHE) to avoid tar conflicts
bac356e 2025-10-19 ci: disable workflow caches to avoid flaky tar/extract errors on runners
34c7feb 2025-10-19 ci: bump setup-go to 1.24 in workflows
974c3d2 2025-10-19 ci: pin setup-go to 1.24.1 (patch release)
de17a72 2025-10-19 release: support rc tag pattern and create prerelease with uploaded artifacts
3bd8d75 2025-10-19 ci: grant contents: write permission for release job to allow creating GitHub releases
fc99d51 2025-10-19 ci: add GITHUB_TOKEN environment variable for uploading release assets
03d1c32 2025-10-19 ci(release): make create-release idempotent (get-or-create) and export upload_url
5413314 2025-10-19 ci(release): replace existing release when tag exists (delete+create)
fad60ea 2025-10-19 ci(release): use upload-release-asset@v3 (repo-token) to avoid deprecated set-output warning
64c7101 2025-10-19 ci(release): use curl to upload release asset (avoid unavailable action v3)

