# v1.0.0-rc2 (draft)

This release candidate accumulates all changes since the project's inception and prepares for the stable 1.0.0 release.

Summary highlights

- Version bump: embedded version updated to `v1.0.0-rc2`.
- Release process: the workflow now replaces an existing release with the same tag and uploads platform-specific binaries individually.
- Relay features: khatru-based relay command, publish forwarding to remotes, query remotes and pooling, CountMany support gated to NIP‑45-capable remotes, NIP‑11 probing using the Accept header.
- Observability: `/stats` endpoint with separate counters for publishes, queries and counts (internal vs external tracked).
- Security/behavior: do not forward khatru internal QueryEvents (except the exact internal adding.kind=5/#e case) and short-circuit internal queries.
- UI & assets: server-rendered homepage, NIP‑11 and stats UI, multiple favicon variants with rounded masks, icon/svg assets.
- CI/Release: GitHub Actions workflows for build/test and release; release automation iterated to be idempotent and robust on restricted runners.

Change categories (grouped)

Features

- Add `cmd/khatru-relay` command and `relaystore` forwarding backend to mirror published events to configured remotes.
- Add query remotes (wss defaults) and QueryEvents via a SimplePool; expose CLI flag `--query-remotes`.
- Forward CountEvents to remotes and use pool.CountMany (NIP‑45 semantics) when remotes advertise NIP‑45.
- Add server-side homepage rendering with NIP‑11 information and a foldable `/stats` UI.

Fixes

- Short-circuit internal khatru QueryEvents to avoid forwarding internal control events; specially handle exact adding.kind=5/#e filter.
- Fix and separate counters for queries vs counts; add metrics for query/count failures and returned events.

Assets & UI

- Add SVG icon variants and generate PNG favicons with rounded masks (40% radius) for modern UIs.
- Improve homepage UI: render contact as mailto/nostr links, show relay npub link, NIP badges linking to nostr-nips.com, responsive layout and stats folding.

Chore / Infrastructure

- Add GAL license and project README with mythic identity text.
- Move Version constant into `cmd/khatru-relay` and embed the tag into builds via ldflags in the release workflow.
- Add `run.sh` helper, example `.env`, and tooling to generate favicons.

CI & Release

- Add GitHub Actions CI workflow (build/test) and a Release workflow that produces platform binaries.
- Iterated workflows to avoid caching/tar extraction conflicts on runners, pinned Go to 1.24.1, and added job-level permissions for release creation.
- Make release creation idempotent: workflow deletes an existing release and recreates it, then uploads artifacts.
- Fallback to curl-based uploads for environments where marketplace action versions are unavailable.

Full commit history is attached to the release as COMMIT_HISTORY.md. See that file for the complete chronological commit log.

